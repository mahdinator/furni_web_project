<%- include('partials/header') %>
<%- include('partials/navbar') %>
<script src="/js/carttable.js"></script>

<div class="hero">
  <div class="container">
    <h1 class="text-center mt-4">Your Cart</h1>
  </div>
</div>

<div class="untree_co-section before-footer-section">
  <div class="container">

    <% if (cart && cart.length > 0) { %>

      <table class="table align-middle text-center mt-4">
        <thead>
          <tr>
            <th>Image</th>
            <th>Product</th>
            <th>Price</th>
            <th>Quantity</th>
            <th>Total</th>
            <th>Remove</th>
          </tr>
        </thead>

        <tbody>
          <% cart.forEach(item => { %>
            <tr class="cart-row" data-id="<%= item.product_id %>" data-price="<%= Number(item.price) %>">
              
              <!-- Product image -->
              <td>
                <img 
                  src="/images/<%= item.image %>" 
                  alt="<%= item.name %>" 
                  class="img-fluid" 
                  style="max-width: 130px;">
              </td>

              <!-- Product name -->
              <td>
                <h5 class="text-black"><%= item.name %></h5>
              </td>

              <!-- Unit price -->
              <td>
                $<span class="unit-price"><%= Number(item.price).toFixed(2) %></span>
              </td>

              <!-- Quantity -->
              <td>
                <div class="d-flex align-items-center justify-content-center gap-2">
                  <button type="button" class="btn btn-dark decrease">âˆ’</button>

                  <input
                    type="text"
                    class="form-control text-center quantity-amount"
                    value="<%= item.quantity %>"
                    style="max-width: 50px;"
                    readonly
                  />

                  <button type="button" class="btn btn-dark increase">+</button>
                </div>
              </td>

              <!-- Row total -->
              <td>
                $<span class="row-total"><%= (item.price * item.quantity).toFixed(2) %></span>
              </td>

              <!-- Remove -->
              <td>
                <button 
                  type="button" 
                  class="btn btn-dark btn-sm remove-item" 
                  data-id="<%= item.product_id %>">
                  X
                </button>
              </td>

            </tr>
          <% }) %>
        </tbody>
      </table>

      <!-- Continue shopping -->
      <div class="row mt-4 mb-5">
        <div class="col-md-6">
          <a href="/shop" class="btn btn-dark btn-lg">Continue Shopping</a>
        </div>
      </div>

      <!-- Cart Totals -->
      <div class="row justify-content-end">
        <div class="col-md-5">
          <div class="card shadow-sm p-4">

            <h4 class="text-uppercase border-bottom pb-2">CART TOTALS</h4>

            <div class="d-flex justify-content-between mt-3">
              <span>Subtotal:</span>
              <strong id="subtotal-value">$<%= subtotal.toFixed(2) %></strong>
            </div>

            <div class="d-flex justify-content-between mt-2">
              <span>Total:</span>
              <strong id="total-value">$<%= subtotal.toFixed(2) %></strong>
            </div>

            <!--  FIXED: Correct button to go to checkout (GET, not POST) -->
            <a href="/cart/checkout" class="btn btn-dark btn-lg w-100 mt-4">
              Proceed To Checkout
            </a>

          </div>
        </div>
      </div>

    <% } else { %>

      <h4 class="text-center my-5">Your cart is empty.</h4>
      <div class="text-center">
        <a href="/shop" class="btn btn-dark btn-lg">Continue Shopping</a>
      </div>

    <% } %>

  </div>
</div>




<%- include('partials/footer') %>
